{"version":3,"file":"index.js","sources":["../src/index.tsx"],"sourcesContent":["import * as React from \"react\";\nimport \"./dropdown.scss\";\n\nexport type Positioning = \"center\" | \"left\" | \"right\";\n\nexport type Mode = \"hover\" | \"click\";\n\nexport type Props = {\n  children: React.ReactNode;\n  className?: string;\n  dropdown: React.ReactNode;\n  dropdownWrapperId: string;\n  hasClickOutsideListener?: boolean;\n  isOpen?: boolean;\n  mode: Mode;\n  positioning: Positioning;\n  wrapperId?: string;\n  zIndex: \"auto\" | number;\n};\n\nconst clamp = ({ left = 0, top = 0, width = 0 }: Partial<DOMRect>) => {\n  let leftCopy = left;\n\n  if (leftCopy < 0) {\n    leftCopy = 0;\n  } else if (left + width > document.documentElement.clientWidth) {\n    leftCopy = document.documentElement.clientWidth - width;\n  }\n\n  return { left: leftCopy, top };\n};\n\nfunction calculatePosition(\n  refContainer: React.RefObject<HTMLDivElement>,\n  refDropdown: React.RefObject<HTMLDivElement>,\n  positioning: Positioning,\n) {\n  const dropdownPosition = refContainer?.current?.getBoundingClientRect() || {\n    left: 0,\n    top: 0,\n    width: 0,\n    height: 0,\n  };\n  let { left } = dropdownPosition;\n  const { top, width, height } = dropdownPosition;\n\n  switch (positioning) {\n    case \"center\":\n      left += width / 2;\n      left -= (refDropdown?.current?.getBoundingClientRect()?.width || 0) / 2;\n      break;\n    case \"left\":\n      break;\n    case \"right\":\n      left += width;\n      left -= refDropdown?.current?.getBoundingClientRect()?.width || 0;\n      break;\n    default:\n      throw new Error(`Unknown positioning ${positioning}`);\n  }\n\n  const clamped = clamp({\n    left,\n    top,\n    width: refDropdown?.current?.getBoundingClientRect().width || 0,\n  });\n\n  return { left: clamped.left, top: clamped.top + height };\n}\n\nfunction Dropdown({\n  children,\n  className = \"dropdown\",\n  dropdown,\n  dropdownWrapperId,\n  hasClickOutsideListener = true,\n  isOpen = undefined,\n  mode = \"hover\",\n  positioning = \"center\",\n  wrapperId,\n  zIndex = \"auto\",\n  ...props\n}: Props) {\n  const [position, setPosition] = React.useState({ left: 0, top: 0 });\n  const [shouldRenderContent, setShouldRenderContent] = React.useState(false);\n  const [isDropdownShown, setIsDropdownShown] = React.useState(false);\n  const refContainer = React.useRef<HTMLDivElement>(null);\n  const refDropdown = React.useRef<HTMLDivElement>(null);\n\n  const IS_CONTROLLED = !(typeof isOpen === \"undefined\" || isOpen === null);\n  let modeCopy = mode;\n\n  if (mode !== \"hover\" && mode !== \"click\") {\n    console.error(\n      \"Use one of ['hover', 'click'] for mode prop. Defaulting to hover.\",\n    );\n    modeCopy = \"hover\";\n  }\n\n  const calculatePositionAndSetState = React.useCallback(() => {\n    if (isDropdownShown) {\n      const position = calculatePosition(\n        refContainer,\n        refDropdown,\n        positioning,\n      );\n      setPosition(position);\n    }\n  }, [isDropdownShown, positioning]);\n\n  React.useEffect(() => {\n    window.addEventListener(\"scroll\", calculatePositionAndSetState);\n    window.addEventListener(\"resize\", calculatePositionAndSetState);\n\n    return () => {\n      window.removeEventListener(\"scroll\", calculatePositionAndSetState);\n      window.removeEventListener(\"resize\", calculatePositionAndSetState);\n    };\n  }, [calculatePositionAndSetState]);\n\n  React.useEffect(() => {\n    if (IS_CONTROLLED) {\n      if (isOpen) {\n        setShouldRenderContent(true);\n      } else {\n        setShouldRenderContent(false);\n      }\n    }\n  }, [IS_CONTROLLED, isOpen]);\n\n  React.useEffect(() => {\n    if (shouldRenderContent) {\n      const position = calculatePosition(\n        refContainer,\n        refDropdown,\n        positioning,\n      );\n      setPosition(position);\n      setIsDropdownShown(true);\n    }\n  }, [positioning, shouldRenderContent]);\n\n  React.useEffect(() => {\n    function outsideClickListener(event: MouseEvent) {\n      if (!refContainer?.current?.contains(event.target as Node)) {\n        setShouldRenderContent(false);\n      }\n    }\n\n    if (hasClickOutsideListener && !IS_CONTROLLED) {\n      window.addEventListener(\"click\", outsideClickListener);\n    }\n    return () => window.removeEventListener(\"click\", outsideClickListener);\n  }, [IS_CONTROLLED, hasClickOutsideListener, positioning]);\n\n  function onKeyDown(event: React.KeyboardEvent<HTMLDivElement>) {\n    if (mode === \"hover\") {\n      if ([\" \", \"Enter\"].includes(event.key)) {\n        setShouldRenderContent((curr) => !curr);\n      }\n    }\n    if (IS_CONTROLLED) {\n      return;\n    }\n  }\n\n  function onMouseEnter() {\n    if (IS_CONTROLLED) {\n      return;\n    }\n    if (modeCopy === \"hover\") {\n      setShouldRenderContent(true);\n    }\n  }\n\n  function onMouseLeave() {\n    if (IS_CONTROLLED) {\n      return;\n    }\n    if (modeCopy === \"hover\") {\n      setShouldRenderContent(false);\n    }\n    return;\n  }\n\n  function onClick(event: React.MouseEvent) {\n    if (IS_CONTROLLED) {\n      return;\n    }\n    if (modeCopy === \"click\") {\n      if (!refDropdown?.current?.contains(event.target as Node)) {\n        setShouldRenderContent((curr) => !curr);\n      }\n    }\n    return;\n  }\n\n  return (\n    <div\n      className={className}\n      tabIndex={IS_CONTROLLED ? undefined : 0}\n      role={IS_CONTROLLED ? undefined : \"button\"}\n      onKeyDown={onKeyDown}\n      id={wrapperId}\n      ref={refContainer}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      onClick={onClick}\n      {...props}\n    >\n      {children}\n      <div\n        className={\"dropdown-wrapper\"}\n        id={dropdownWrapperId}\n        ref={refDropdown}\n        style={{\n          visibility: isDropdownShown ? \"visible\" : \"hidden\",\n          top: position.top,\n          left: position.left,\n          zIndex,\n        }}\n      >\n        {shouldRenderContent ? dropdown : null}\n      </div>\n    </div>\n  );\n}\n\nexport default Dropdown;\n"],"names":["React.useState","React.useRef","React.useCallback","React.useEffect","React.createElement"],"mappings":"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"}