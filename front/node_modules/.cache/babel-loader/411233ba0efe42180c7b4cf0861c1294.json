{"ast":null,"code":"import _regeneratorRuntime from\"/home/webmaster/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import{call,put}from\"redux-saga/effects\";import{startLoading,finishLoading}from\"../store/modules/loading\";import{ACCESS_TOKEN,REFRESH_TOKEN}from\"./config\";export var createRequestActionTypes=function createRequestActionTypes(type){var SUCCESS=\"\".concat(type,\"_SUCCESS\");var FAILURE=\"\".concat(type,\"_FAILURE\");return[type,SUCCESS,FAILURE];};export default function createRequestSaga(type,request){var SUCCESS=\"\".concat(type,\"_SUCCESS\");var FAILURE=\"\".concat(type,\"_FAILURE\");return/*#__PURE__*/_regeneratorRuntime.mark(function _callee(action){var response,_response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return put(startLoading(type));case 2:_context.prev=2;_context.next=5;return call(request,action.payload);case 5:response=_context.sent;if(!(type===\"auth/LOGIN\")){_context.next=11;break;}_context.next=9;return put({type:SUCCESS,payload:response.data,meta:response});case 9:_context.next=13;break;case 11:_context.next=13;return put({type:SUCCESS,payload:response.data.message,meta:response});case 13:_context.next=33;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](2);_response=_context.t0.response;if(!(_response&&_response.status===400||_response.status===403)){_context.next=23;break;}_context.next=21;return put({type:FAILURE,payload:_context.t0.response.data.message,error:true});case 21:_context.next=33;break;case 23:if(!(_response&&_response.status===401)){_context.next=31;break;}localStorage.removeItem(\"user\");localStorage.removeItem(ACCESS_TOKEN);localStorage.removeItem(REFRESH_TOKEN);_context.next=29;return put({type:FAILURE,payload:_context.t0.response.data.detail,error:true});case 29:_context.next=33;break;case 31:_context.next=33;return put({type:FAILURE,payload:_context.t0.message,error:true});case 33:_context.next=35;return put(finishLoading(type));case 35:case\"end\":return _context.stop();}}},_callee,null,[[2,15]]);});}","map":{"version":3,"sources":["/home/webmaster/front/src/lib/createRequestSaga.js"],"names":["call","put","startLoading","finishLoading","ACCESS_TOKEN","REFRESH_TOKEN","createRequestActionTypes","type","SUCCESS","FAILURE","createRequestSaga","request","action","payload","response","data","meta","message","status","error","localStorage","removeItem","detail"],"mappings":"mIAAA,OAASA,IAAT,CAAeC,GAAf,KAA0B,oBAA1B,CACA,OAASC,YAAT,CAAuBC,aAAvB,KAA4C,0BAA5C,CACA,OAASC,YAAT,CAAuBC,aAAvB,KAA4C,UAA5C,CAEA,MAAO,IAAMC,CAAAA,wBAAwB,CAAG,QAA3BA,CAAAA,wBAA2B,CAAAC,IAAI,CAAI,CAC9C,GAAMC,CAAAA,OAAO,WAAMD,IAAN,YAAb,CACA,GAAME,CAAAA,OAAO,WAAMF,IAAN,YAAb,CACA,MAAO,CAACA,IAAD,CAAOC,OAAP,CAAgBC,OAAhB,CAAP,CACD,CAJM,CAMP,cAAe,SAASC,CAAAA,iBAAT,CAA2BH,IAA3B,CAAiCI,OAAjC,CAA0C,CACvD,GAAMH,CAAAA,OAAO,WAAMD,IAAN,YAAb,CACA,GAAME,CAAAA,OAAO,WAAMF,IAAN,YAAb,CAEA,4CAAO,iBAAWK,MAAX,yJACL,MAAMX,CAAAA,GAAG,CAACC,YAAY,CAACK,IAAD,CAAb,CAAT,CADK,uCAGc,MAAMP,CAAAA,IAAI,CAACW,OAAD,CAAUC,MAAM,CAACC,OAAjB,CAAV,CAHd,OAGGC,QAHH,oBAQHP,IAAI,GAAK,YARN,2CASC,MAAMN,CAAAA,GAAG,CAAC,CACRM,IAAI,CAAEC,OADE,CAERK,OAAO,CAAEC,QAAQ,CAACC,IAFV,CAGRC,IAAI,CAAEF,QAHE,CAAD,CAAT,CATD,uDAcC,MAAMb,CAAAA,GAAG,CAAC,CACRM,IAAI,CAAEC,OADE,CAERK,OAAO,CAAEC,QAAQ,CAACC,IAAT,CAAcE,OAFf,CAGRD,IAAI,CAAEF,QAHE,CAAD,CAAT,CAdD,yFAoBKA,SApBL,aAoBKA,QApBL,MAqBEA,SAAQ,EAAIA,SAAQ,CAACI,MAAT,GAAoB,GAAjC,EAAyCJ,SAAQ,CAACI,MAAT,GAAoB,GArB9D,4CAsBD,MAAMjB,CAAAA,GAAG,CAAC,CACRM,IAAI,CAAEE,OADE,CAERI,OAAO,CAAE,YAAEC,QAAF,CAAWC,IAAX,CAAgBE,OAFjB,CAGRE,KAAK,CAAE,IAHC,CAAD,CAAT,CAtBC,4CA2BQL,SAAQ,EAAIA,SAAQ,CAACI,MAAT,GAAoB,GA3BxC,2BA4BDE,YAAY,CAACC,UAAb,CAAwB,MAAxB,EACAD,YAAY,CAACC,UAAb,CAAwBjB,YAAxB,EACAgB,YAAY,CAACC,UAAb,CAAwBhB,aAAxB,EA9BC,iBA+BD,MAAMJ,CAAAA,GAAG,CAAC,CACRM,IAAI,CAAEE,OADE,CAERI,OAAO,CAAE,YAAEC,QAAF,CAAWC,IAAX,CAAgBO,MAFjB,CAGRH,KAAK,CAAE,IAHC,CAAD,CAAT,CA/BC,wDAqCD,MAAMlB,CAAAA,GAAG,CAAC,CACRM,IAAI,CAAEE,OADE,CAERI,OAAO,CAAE,YAAEI,OAFH,CAGRE,KAAK,CAAE,IAHC,CAAD,CAAT,CArCC,yBA6CL,MAAMlB,CAAAA,GAAG,CAACE,aAAa,CAACI,IAAD,CAAd,CAAT,CA7CK,qEAAP,EA+CD","sourcesContent":["import { call, put } from \"redux-saga/effects\";\nimport { startLoading, finishLoading } from \"../store/modules/loading\";\nimport { ACCESS_TOKEN, REFRESH_TOKEN } from \"./config\";\n\nexport const createRequestActionTypes = type => {\n  const SUCCESS = `${type}_SUCCESS`;\n  const FAILURE = `${type}_FAILURE`;\n  return [type, SUCCESS, FAILURE];\n};\n\nexport default function createRequestSaga(type, request) {\n  const SUCCESS = `${type}_SUCCESS`;\n  const FAILURE = `${type}_FAILURE`;\n\n  return function* (action) {\n    yield put(startLoading(type)); // 로딩 시작\n    try {\n      const response = yield call(request, action.payload);\n\n      // if (!response.data.results) {\n      //   window.location.replace(\"/login\");\n      // }\n      type === \"auth/LOGIN\"\n        ? yield put({\n            type: SUCCESS,\n            payload: response.data,\n            meta: response\n          })\n        : yield put({\n            type: SUCCESS,\n            payload: response.data.message,\n            meta: response\n          });\n    } catch (e) {\n      const { response } = e;\n      if ((response && response.status === 400) || response.status === 403) {\n        yield put({\n          type: FAILURE,\n          payload: e.response.data.message,\n          error: true\n        });\n      } else if (response && response.status === 401) {\n        localStorage.removeItem(\"user\");\n        localStorage.removeItem(ACCESS_TOKEN);\n        localStorage.removeItem(REFRESH_TOKEN);\n        yield put({\n          type: FAILURE,\n          payload: e.response.data.detail,\n          error: true\n        });\n      } else {\n        yield put({\n          type: FAILURE,\n          payload: e.message,\n          error: true\n        });\n      }\n    }\n\n    yield put(finishLoading(type)); // 로딩 끝\n  };\n}\n"]},"metadata":{},"sourceType":"module"}