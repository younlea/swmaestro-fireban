{"ast":null,"code":"import _objectSpread from\"/home/webmaster/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/webmaster/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{Stage,Layer,Rect}from\"react-konva\";import{useHistory}from\"react-router-dom\";var Canvas=function Canvas(_ref){var initialState=_ref.initialState;var history=useHistory();var _useState=useState(0),_useState2=_slicedToArray(_useState,2),size=_useState2[0],setSize=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),newWidth=_useState4[0],setNewWidth=_useState4[1];useEffect(function(){var targetImg=document.querySelector(\"img\");if(targetImg){if(targetImg.naturalWidth===0){history.go();}else{setNewWidth(targetImg.width/targetImg.naturalWidth);}setSize(targetImg.width);}function reSizeWidth(){setNewWidth(targetImg.width/targetImg.naturalWidth);}function updateSize(){setSize([targetImg.width]);reSizeWidth();}window.addEventListener(\"resize\",updateSize);updateSize();//   nValue.current = targetImg.width;\nreturn function(){return window.removeEventListener(\"resize\",updateSize);};},[history]);var _React$useState=React.useState(initialState),_React$useState2=_slicedToArray(_React$useState,2),detect=_React$useState2[0],setDetect=_React$useState2[1];var handleDragStart=function handleDragStart(e){var id=e.target.id();setDetect(detect.map(function(item){return _objectSpread({},item,{isDragging:item.id===id});}));};var handleDragEnd=function handleDragEnd(e){setDetect(detect.map(function(item){return _objectSpread({},item,{isDragging:false});}));};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Stage,{width:size,height:window.innerHeight},/*#__PURE__*/React.createElement(Layer,{style:{position:\"absolute\"}},initialState&&newWidth!==0&&initialState.map(function(item){return/*#__PURE__*/React.createElement(Rect,{style:{position:\"absolute\"},key:item.pk,id:item.pk,draggable:true,type:item.type,x:item.x*newWidth,y:item.y*newWidth,width:item.width*newWidth,height:item.height*newWidth,stroke:\"red\",onDragStart:handleDragStart,onDragEnd:handleDragEnd});}))));};export default Canvas;","map":{"version":3,"sources":["/home/webmaster/front/src/components/Detect/Canvas.js"],"names":["React","useEffect","useState","Stage","Layer","Rect","useHistory","Canvas","initialState","history","size","setSize","newWidth","setNewWidth","targetImg","document","querySelector","naturalWidth","go","width","reSizeWidth","updateSize","window","addEventListener","removeEventListener","detect","setDetect","handleDragStart","e","id","target","map","item","isDragging","handleDragEnd","innerHeight","position","pk","type","x","y","height"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { Stage, Layer, Rect } from \"react-konva\";\nimport { useHistory } from \"react-router-dom\";\n\nconst Canvas = ({ initialState }) => {\n  const history = useHistory();\n  const [size, setSize] = useState(0);\n  const [newWidth, setNewWidth] = useState(0);\n\n  useEffect(() => {\n    const targetImg = document.querySelector(\"img\");\n    if (targetImg) {\n      if (targetImg.naturalWidth === 0) {\n        history.go();\n      } else {\n        setNewWidth(targetImg.width / targetImg.naturalWidth);\n      }\n\n      setSize(targetImg.width);\n    }\n\n    function reSizeWidth() {\n      setNewWidth(targetImg.width / targetImg.naturalWidth);\n    }\n    function updateSize() {\n      setSize([targetImg.width]);\n      reSizeWidth();\n    }\n    window.addEventListener(\"resize\", updateSize);\n    updateSize();\n    //   nValue.current = targetImg.width;\n\n    return () => window.removeEventListener(\"resize\", updateSize);\n  }, [history]);\n  const [detect, setDetect] = React.useState(initialState);\n\n  const handleDragStart = e => {\n    const id = e.target.id();\n    setDetect(\n      detect.map(item => {\n        return {\n          ...item,\n          isDragging: item.id === id\n        };\n      })\n    );\n  };\n  const handleDragEnd = e => {\n    setDetect(\n      detect.map(item => {\n        return {\n          ...item,\n          isDragging: false\n        };\n      })\n    );\n  };\n\n  return (\n    <>\n      <Stage width={size} height={window.innerHeight}>\n        <Layer style={{ position: \"absolute\" }}>\n          {initialState &&\n            newWidth !== 0 &&\n            initialState.map(item => (\n              <Rect\n                style={{ position: \"absolute\" }}\n                key={item.pk}\n                id={item.pk}\n                draggable\n                type={item.type}\n                x={item.x * newWidth}\n                y={item.y * newWidth}\n                width={item.width * newWidth}\n                height={item.height * newWidth}\n                stroke=\"red\"\n                onDragStart={handleDragStart}\n                onDragEnd={handleDragEnd}\n              />\n            ))}\n        </Layer>\n      </Stage>\n    </>\n  );\n};\n\nexport default Canvas;\n"]},"metadata":{},"sourceType":"module"}