{"ast":null,"code":"import _slicedToArray from\"/home/webmaster/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState}from\"react\";import ReactPlayer from\"react-player\";import{useDispatch,useSelector}from\"react-redux\";import{getTargetGps}from\"../../store/modules/video\";import KakaoMap from\"../KakaoMap/KakaoMap\";function RecordPlayer(_ref){var streamUrl=_ref.streamUrl,targetInfo=_ref.targetInfo;function getFormatDate(date){var year=date.getFullYear();//yyyy\nvar month=1+date.getMonth();//M\nmonth=month>=10?month:'0'+month;//month 두자리로 저장\nvar day=date.getDate();//d\nday=day>=10?day:'0'+day;//day 두자리로 저장\nvar hour=date.getHours();hour=hour>=10?hour:'0'+hour;var min=date.getMinutes();var sec=date.getSeconds();return year+'-'+month+'-'+day+' '+hour+':'+min+':'+sec;//'-' 추가하여 yyyy-mm-dd 형태 생성 가능\n}var dispatch=useDispatch();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),duration=_useState2[0],setDuration=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),secondsElapsed=_useState4[0],setSecondsElapsed=_useState4[1];var currentTime=useRef(0);var gpsInfo=useSelector(function(state){return state.video.targetGps;});var targetDate=targetInfo.createdAt.replace(/-/g,\"\").replace(\" \",\"\").replace(/:/g,\"\");var initialDate=new Date(targetDate.substring(0,4),targetDate.substring(4,6)-1,targetDate.substring(6,8),targetDate.substring(8,10),targetDate.substring(10,12),targetDate.substring(12,14));currentTime.current=initialDate;console.log(initialDate.getTime());var mac=targetInfo.target.mac;var onDuration=function onDuration(duration){setDuration({duration:duration});};var onProgress=function onProgress(progress){if(!duration){return;}var test=Number(progress.played)*Number(duration.duration);currentTime.current=(currentTime.current/1000-duration.duration+test)*1000;dispatch(getTargetGps(mac,getFormatDate(new Date(currentTime.current))));if(test!==secondsElapsed){setSecondsElapsed({test:test});}};var url=\"http://www.fireban.kr\"+streamUrl;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(ReactPlayer,{className:\"react-player\",url:url,width:\"100%\",height:\"50vh\"// onReady=\"true\"\n,controls:true,onDuration:onDuration,onProgress:onProgress}),/*#__PURE__*/React.createElement(KakaoMap// className={classes.mainPanel}\n,{cordinateX:gpsInfo&&gpsInfo.cordinateX?gpsInfo.cordinateX:\"37.504234\"// gpsInfo.cordinateX\n,cordinateY:gpsInfo&&gpsInfo.cordinateY?gpsInfo.cordinateY:\"127.047812\"// gpsInfo.cordinateY\n}));}export default RecordPlayer;","map":{"version":3,"sources":["/home/webmaster/front/src/components/Record/RecordPlayer.js"],"names":["React","useRef","useState","ReactPlayer","useDispatch","useSelector","getTargetGps","KakaoMap","RecordPlayer","streamUrl","targetInfo","getFormatDate","date","year","getFullYear","month","getMonth","day","getDate","hour","getHours","min","getMinutes","sec","getSeconds","dispatch","duration","setDuration","secondsElapsed","setSecondsElapsed","currentTime","gpsInfo","state","video","targetGps","targetDate","createdAt","replace","initialDate","Date","substring","current","console","log","getTime","mac","target","onDuration","onProgress","progress","test","Number","played","url","cordinateX","cordinateY"],"mappings":"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","sourcesContent":["import React, { useRef, useState } from \"react\";\n\nimport ReactPlayer from \"react-player\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { getTargetGps } from \"../../store/modules/video\";\nimport KakaoMap from \"../KakaoMap/KakaoMap\";\nfunction RecordPlayer({ streamUrl, targetInfo }) {\n\n  function getFormatDate(date){\n    var year = date.getFullYear();              //yyyy\n    var month = (1 + date.getMonth());          //M\n    month = month >= 10 ? month : '0' + month;  //month 두자리로 저장\n    var day = date.getDate();                   //d\n    day = day >= 10 ? day : '0' + day;          //day 두자리로 저장\n    var hour = date.getHours()\n    hour = hour >= 10 ? hour : '0' + hour;\n    var min = date.getMinutes()\n    var sec = date.getSeconds()\n    return  year + '-' + month + '-' + day + ' ' + hour+':'+min+':'+sec;       //'-' 추가하여 yyyy-mm-dd 형태 생성 가능\n}\n\n  const dispatch= useDispatch();\n  const [duration, setDuration] = useState(null);\n  const [secondsElapsed, setSecondsElapsed] = useState(null);\n  let currentTime = useRef(0);\n\n  const gpsInfo = useSelector(state => state.video.targetGps)\n\n  const targetDate = targetInfo.createdAt.replace(/-/g,\"\").replace(\" \", \"\").replace(/:/g, \"\");\n\n  const initialDate = new Date(targetDate.substring(0, 4), targetDate.substring(4, 6)-1, targetDate.substring(6, 8), targetDate.substring(8, 10), targetDate.substring(10, 12), targetDate.substring(12, 14))\n\n  currentTime.current = initialDate;\n  console.log(initialDate.getTime())\n\n  const mac = targetInfo.target.mac;\n  \n  const onDuration = duration => {\n    setDuration({ duration });\n  };\n  const onProgress = progress => {\n    if (!duration) {\n      return;\n    }\n\n    const test = Number(progress.played) * Number(duration.duration);\n    \n    currentTime.current = (currentTime.current/1000 - duration.duration+test)*1000\n    dispatch(getTargetGps(mac,  getFormatDate(new Date(currentTime.current))))\n\n\n\n    if (test !== secondsElapsed) {\n      setSecondsElapsed({ test });\n    }\n  };\n  const url = \"http://www.fireban.kr\" + streamUrl;\n\n  return (\n    <>\n      <ReactPlayer\n        className=\"react-player\"\n        url={url}\n        width=\"100%\"\n        height=\"50vh\"\n        // onReady=\"true\"\n        controls={true}\n        onDuration={onDuration}\n        onProgress={onProgress}\n      />\n      <KakaoMap\n            // className={classes.mainPanel}\n            cordinateX={\n              gpsInfo && gpsInfo.cordinateX ? gpsInfo.cordinateX : \"37.504234\"\n              // gpsInfo.cordinateX\n            }\n            cordinateY={\n              gpsInfo && gpsInfo.cordinateY ? gpsInfo.cordinateY : \"127.047812\"\n              // gpsInfo.cordinateY\n            }\n          ></KakaoMap>\n    </>\n  );\n}\n\nexport default RecordPlayer;\n"]},"metadata":{},"sourceType":"module"}