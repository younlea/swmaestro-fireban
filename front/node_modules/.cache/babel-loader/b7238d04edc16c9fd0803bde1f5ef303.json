{"ast":null,"code":"import _slicedToArray from\"/home/webmaster/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/home/webmaster/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject3(){var data=_taggedTemplateLiteral([\"\\n          display: none;\\n        \"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n          display: inline;\\n        \"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  \",\";\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useEffect,useState}from\"react\";import{makeStyles}from\"@material-ui/core/styles\";import styles from\"../assets/jss/material-dashboard-react/layouts/adminStyle.js\";import SidebarContainer from\"./SidebarContainer.js\";import NavbarContainer from\"./NavbarContainer.js\";import StreamPlayer from\"../components/Stream/StreamPlayer.js\";import KakaoMap from\"../components/KakaoMap/KakaoMap.js\";import{useHistory}from\"react-router-dom\";import styled,{css}from\"styled-components\";import{useDispatch,useSelector}from\"react-redux\";import{changeGpsTarget,getGpsInfo}from\"../store/modules/stream.js\";import SubNavContainer from\"../components/Common/SubNavContainer.js\";import SubNavComponent from\"../components/Common/SubNavComponent.js\";var mainPanel=React.createRef();var VideoContainer=styled.div(_templateObject(),function(props){return props.visible?css(_templateObject2()):css(_templateObject3());});function StreamContainer(_ref){var match=_ref.match;var dispatch=useDispatch();var target=useSelector(function(state){return state.stream.target;});var gpsInfo=useSelector(function(state){return state.stream.gpsInfo;});var _useState=useState(true),_useState2=_slicedToArray(_useState,2),isTic=_useState2[0],setIsTic=_useState2[1];var history=useHistory();var key=match.params.key;useEffect(function(){if(target!==key){console.log(target,key);dispatch(changeGpsTarget(key));setInterval(function(){return dispatch(getGpsInfo(key));},5000);}},[dispatch,key,target]);if(!key){// 통신 안되면 뒤로 가기\nhistory.push(\"/stream\");}var ticStream=\"/api/stream/tic/\"+key+\"/index.m3u8\";var hlsStream=\"/api/stream/live/\"+key+\"/index.m3u8\";var useStyles=makeStyles(styles);var classes=useStyles();var onChangeSteam=function onChangeSteam(e){dispatch(getGpsInfo(key));setIsTic(!isTic);};return/*#__PURE__*/React.createElement(\"div\",{className:classes.wrapper},/*#__PURE__*/React.createElement(SidebarContainer,null),/*#__PURE__*/React.createElement(\"div\",{className:classes.mainPanel,ref:mainPanel},/*#__PURE__*/React.createElement(NavbarContainer,null),/*#__PURE__*/React.createElement(\"div\",{className:classes.content},/*#__PURE__*/React.createElement(SubNavContainer,null,/*#__PURE__*/React.createElement(SubNavComponent,{onClick:onChangeSteam},isTic?\"일반 영상으로\":\"열화상 영상으로\",\" \\uBCC0\\uACBD\")),/*#__PURE__*/React.createElement(VideoContainer,{visible:isTic},/*#__PURE__*/React.createElement(StreamPlayer,{streamUrl:ticStream})),/*#__PURE__*/React.createElement(VideoContainer,{visible:!isTic},/*#__PURE__*/React.createElement(StreamPlayer,{streamUrl:hlsStream})),/*#__PURE__*/React.createElement(KakaoMap,{className:classes.mainPanel,cordinateX:gpsInfo&&gpsInfo.cordinateX?gpsInfo.cordinateX:\"37.504234\",cordinateY:gpsInfo&&gpsInfo.cordinateY?gpsInfo.cordinateY:\"127.047812\"}))));}export default StreamContainer;","map":{"version":3,"sources":["/home/webmaster/front/src/containers/StreamContainer.js"],"names":["React","useEffect","useState","makeStyles","styles","SidebarContainer","NavbarContainer","StreamPlayer","KakaoMap","useHistory","styled","css","useDispatch","useSelector","changeGpsTarget","getGpsInfo","SubNavContainer","SubNavComponent","mainPanel","createRef","VideoContainer","div","props","visible","StreamContainer","match","dispatch","target","state","stream","gpsInfo","isTic","setIsTic","history","key","params","console","log","setInterval","push","ticStream","hlsStream","useStyles","classes","onChangeSteam","e","wrapper","content","cordinateX","cordinateY"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport styles from \"../assets/jss/material-dashboard-react/layouts/adminStyle.js\";\nimport SidebarContainer from \"./SidebarContainer.js\";\nimport NavbarContainer from \"./NavbarContainer.js\";\nimport StreamPlayer from \"../components/Stream/StreamPlayer.js\";\nimport KakaoMap from \"../components/KakaoMap/KakaoMap.js\";\nimport { useHistory } from \"react-router-dom\";\nimport styled, { css } from \"styled-components\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { changeGpsTarget, getGpsInfo } from \"../store/modules/stream.js\";\nimport SubNavContainer from \"../components/Common/SubNavContainer.js\";\nimport SubNavComponent from \"../components/Common/SubNavComponent.js\";\nconst mainPanel = React.createRef();\n\nconst VideoContainer = styled.div`\n  ${props =>\n    props.visible\n      ? css`\n          display: inline;\n        `\n      : css`\n          display: none;\n        `};\n`;\n\nfunction StreamContainer({ match }) {\n  const dispatch = useDispatch();\n  const target = useSelector(state => state.stream.target);\n  const gpsInfo = useSelector(state => state.stream.gpsInfo);\n  const [isTic, setIsTic] = useState(true);\n  const history = useHistory();\n  const key = match.params.key;\n\n  useEffect(() => {\n    if (target !== key) {\n      console.log(target, key);\n      dispatch(changeGpsTarget(key));\n      setInterval(() => dispatch(getGpsInfo(key)), 5000);\n    }\n  }, [dispatch, key, target]);\n\n  if (!key) {\n    // 통신 안되면 뒤로 가기\n    history.push(\"/stream\");\n  }\n\n  const ticStream = \"/api/stream/tic/\" + key + \"/index.m3u8\";\n  const hlsStream = \"/api/stream/live/\" + key + \"/index.m3u8\";\n\n  const useStyles = makeStyles(styles);\n  const classes = useStyles();\n\n  const onChangeSteam = e => {\n    dispatch(getGpsInfo(key));\n    setIsTic(!isTic);\n  };\n\n  return (\n    <div className={classes.wrapper}>\n      <SidebarContainer></SidebarContainer>\n      <div className={classes.mainPanel} ref={mainPanel}>\n        <NavbarContainer />\n\n        <div className={classes.content}>\n          <SubNavContainer>\n            <SubNavComponent onClick={onChangeSteam}>\n              {isTic ? \"일반 영상으로\" : \"열화상 영상으로\"} 변경\n            </SubNavComponent>\n          </SubNavContainer>\n          <VideoContainer visible={isTic}>\n            <StreamPlayer streamUrl={ticStream}></StreamPlayer>\n          </VideoContainer>\n          <VideoContainer visible={!isTic}>\n            <StreamPlayer streamUrl={hlsStream}></StreamPlayer>\n          </VideoContainer>\n          <KakaoMap\n            className={classes.mainPanel}\n            cordinateX={\n              gpsInfo && gpsInfo.cordinateX ? gpsInfo.cordinateX : \"37.504234\"\n            }\n            cordinateY={\n              gpsInfo && gpsInfo.cordinateY ? gpsInfo.cordinateY : \"127.047812\"\n            }\n          ></KakaoMap>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default StreamContainer;\n"]},"metadata":{},"sourceType":"module"}